- name: Assertions
  assert:
    that:
      - ssl is defined
      - "'fullchain' in ssl"
      - "'key' in ssl"
    fail_msg: "Must define SSL certificate paths in ssl.fullchain and ssl.key!"
- name: Template server block(s)
  template:
    src: subdomain.conf.jinja2
    dest: "{{ (nginx_sites_available, subdomain + '.conf') | path_join }}"
- name: Enable config
  file:
    src: "{{ (nginx_sites_available, subdomain + '.conf') | path_join }}"
    dest: "{{ (nginx_sites_enabled, subdomain + '.conf') | path_join }}"
    state: link